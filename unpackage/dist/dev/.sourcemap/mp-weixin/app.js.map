{"version":3,"file":"app.js","sources":["App.vue"],"sourcesContent":["<script>\n\texport default {\n\t\tglobalData: {\n\t\t\tuserInfo: null,\n\t\t\tfavorites: []\n\t\t},\n\t\tasync onLaunch() {\n\t\t\ttry {\n\t\t\t\t// 使用微信原生登录获取 code\n\t\t\t\tconst loginRes = await uni.login({\n\t\t\t\t\tprovider: 'weixin'\n\t\t\t\t});\n\n\t\t\t\tif (loginRes.code) {\n\t\t\t\t\t// 使用 code 获取 openid\n\t\t\t\t\tconst { result } = await uniCloud.callFunction({\n\t\t\t\t\t\tname: 'switchApi',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\taction: 'silentLogin',\n\t\t\t\t\t\t\tcode: loginRes.code\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif (result.errCode === 0) {\n\t\t\t\t\t\t// 只保存必要的用户信息\n\t\t\t\t\t\tthis.globalData.userInfo = {\n\t\t\t\t\t\t\topenid: result.openid\n\t\t\t\t\t\t};\n\t\t\t\t\t\tconsole.log('静默登录成功:', this.globalData.userInfo);\n\n\t\t\t\t\t\t// 获取用户收藏数据\n\t\t\t\t\t\tawait this.fetchUserFavorites();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error('登录异常:', e);\n\t\t\t}\n\t\t},\n\t\t// 获取用户收藏数据\n\t\tasync fetchUserFavorites() {\n\t\t\ttry {\n\t\t\t\tif (!this.globalData.userInfo?.openid) return;\n\n\t\t\t\tconst { result } = await uniCloud.callFunction({\n\t\t\t\t\tname: 'switchApi',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\taction: 'getUserFavorites',\n\t\t\t\t\t\topenid: this.globalData.userInfo.openid\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (result.errCode === 0) {\n\t\t\t\t\t// 保存收藏数据到全局\n\t\t\t\t\tthis.globalData.favorites = result.data;\n\t\t\t\t\tconsole.log('获取收藏数据成功:', result.data.length);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error('获取收藏数据失败:', e);\n\t\t\t}\n\t\t},\n\t\tonShow: function() {\n\t\t\tconsole.log('App Show')\n\t\t},\n\t\tonHide: function() {\n\t\t\tconsole.log('App Hide')\n\t\t}\n\t}\n</script>\n\n<style lang=\"scss\">\n\t/*每个页面公共css */\n\t@import '@/uni_modules/uni-scss/index.scss';\n\t/* #ifndef APP-NVUE */\n\t@import '@/static/customicons.css';\n\t// 设置整个项目的背景色\n\tpage {\n\t\tbackground-color: #f5f5f5;\n\t}\n\n\t/* #endif */\n\t.example-info {\n\t\tfont-size: 14px;\n\t\tcolor: #333;\n\t\tpadding: 10px;\n\t}\n</style>\n"],"names":["uni","uniCloud"],"mappings":";;;;;;;AACC,MAAK,YAAU;AAAA,EACd,YAAY;AAAA,IACX,UAAU;AAAA,IACV,WAAW,CAAC;AAAA,EACZ;AAAA,EACD,MAAM,WAAW;AAChB,QAAI;AAEH,YAAM,WAAW,MAAMA,cAAG,MAAC,MAAM;AAAA,QAChC,UAAU;AAAA,MACX,CAAC;AAED,UAAI,SAAS,MAAM;AAElB,cAAM,EAAE,WAAW,MAAMC,cAAAA,GAAS,aAAa;AAAA,UAC9C,MAAM;AAAA,UACN,MAAM;AAAA,YACL,QAAQ;AAAA,YACR,MAAM,SAAS;AAAA,UAChB;AAAA,QACD,CAAC;AAED,YAAI,OAAO,YAAY,GAAG;AAEzB,eAAK,WAAW,WAAW;AAAA,YAC1B,QAAQ,OAAO;AAAA;AAEhBD,8BAAA,MAAA,OAAA,iBAAY,WAAW,KAAK,WAAW,QAAQ;AAG/C,gBAAM,KAAK;QACZ;AAAA,MACD;AAAA,IACD,SAAS,GAAG;AACXA,oBAAA,MAAA,MAAA,SAAA,iBAAc,SAAS,CAAC;AAAA,IACzB;AAAA,EACA;AAAA;AAAA,EAED,MAAM,qBAAqB;;AAC1B,QAAI;AACH,UAAI,GAAC,UAAK,WAAW,aAAhB,mBAA0B;AAAQ;AAEvC,YAAM,EAAE,WAAW,MAAMC,cAAAA,GAAS,aAAa;AAAA,QAC9C,MAAM;AAAA,QACN,MAAM;AAAA,UACL,QAAQ;AAAA,UACR,QAAQ,KAAK,WAAW,SAAS;AAAA,QAClC;AAAA,MACD,CAAC;AAED,UAAI,OAAO,YAAY,GAAG;AAEzB,aAAK,WAAW,YAAY,OAAO;AACnCD,4BAAA,MAAA,OAAA,iBAAY,aAAa,OAAO,KAAK,MAAM;AAAA,MAC5C;AAAA,IACD,SAAS,GAAG;AACXA,0DAAc,aAAa,CAAC;AAAA,IAC7B;AAAA,EACA;AAAA,EACD,QAAQ,WAAW;AAClBA,kBAAAA,MAAY,MAAA,OAAA,iBAAA,UAAU;AAAA,EACtB;AAAA,EACD,QAAQ,WAAW;AAClBA,kBAAAA,MAAY,MAAA,OAAA,iBAAA,UAAU;AAAA,EACvB;AACD;;;;;;;;;"}