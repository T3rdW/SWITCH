{"version":3,"file":"app.js","sources":["App.vue"],"sourcesContent":["<script>\n\t// 定义一个全局函数来获取收藏数据\n\tfunction getFavorites(app) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (!app.globalData.userInfo?.openid) {\n\t\t\t\tconsole.log('没有 openid，无法获取收藏');\n\t\t\t\tresolve([]);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconsole.log('准备调用云函数获取收藏');\n\t\t\tuniCloud.callFunction({\n\t\t\t\tname: 'switchApi',\n\t\t\t\tdata: {\n\t\t\t\t\taction: 'getUserFavorites',\n\t\t\t\t\topenid: app.globalData.userInfo.openid\n\t\t\t\t}\n\t\t\t}).then(({ result }) => {\n\t\t\t\tconsole.log('云函数返回结果:', result);\n\t\t\t\tif (result.errCode === 0) {\n\t\t\t\t\tapp.globalData.favorites = result.data;\n\t\t\t\t\tconsole.log('获取收藏数据成功:', result.data.length);\n\t\t\t\t\tresolve(result.data);\n\t\t\t\t} else {\n\t\t\t\t\tresolve([]);\n\t\t\t\t}\n\t\t\t}).catch(e => {\n\t\t\t\tconsole.error('获取收藏数据失败:', e);\n\t\t\t\treject(e);\n\t\t\t});\n\t\t});\n\t}\n\n\texport default {\n\t\tglobalData: {\n\t\t\tuserInfo: null,\n\t\t\tfavorites: []\n\t\t},\n\t\tasync onLaunch() {\n\t\t\ttry {\n\t\t\t\tconsole.log('App onLaunch');\n\t\t\t\t// 使用微信原生登录获取 code\n\t\t\t\tconst loginRes = await uni.login({\n\t\t\t\t\tprovider: 'weixin'\n\t\t\t\t});\n\n\t\t\t\tconsole.log('登录结果:', loginRes);\n\t\t\t\tif (loginRes.code) {\n\t\t\t\t\t// 使用 code 获取 openid\n\t\t\t\t\tconsole.log('准备调用 silentLogin');\n\t\t\t\t\tconst { result } = await uniCloud.callFunction({\n\t\t\t\t\t\tname: 'switchApi',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\taction: 'silentLogin',\n\t\t\t\t\t\t\tcode: loginRes.code\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tconsole.log('silentLogin 返回:', result);\n\t\t\t\t\tif (result.errCode === 0) {\n\t\t\t\t\t\t// 只保存必要的用户信息\n\t\t\t\t\t\tthis.globalData.userInfo = {\n\t\t\t\t\t\t\topenid: result.openid\n\t\t\t\t\t\t};\n\t\t\t\t\t\tconsole.log('静默登录成功:', this.globalData.userInfo);\n\n\t\t\t\t\t\t// 获取用户收藏数据\n\t\t\t\t\t\t// 使用全局函数获取收藏\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait getFavorites(this);\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tconsole.error('获取收藏失败:', e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error('登录异常:', e);\n\t\t\t}\n\t\t},\n\t\tonShow: function() {\n\t\t\tconsole.log('App Show')\n\t\t},\n\t\tonHide: function() {\n\t\t\tconsole.log('App Hide')\n\t\t}\n\t}\n</script>\n\n<style lang=\"scss\">\n\t/*每个页面公共css */\n\t@import '@/uni_modules/uni-scss/index.scss';\n\t/* #ifndef APP-NVUE */\n\t@import '@/static/customicons.css';\n\t// 设置整个项目的背景色\n\tpage {\n\t\tbackground-color: #f5f5f5;\n\t}\n\n\t/* #endif */\n\t.example-info {\n\t\tfont-size: 14px;\n\t\tcolor: #333;\n\t\tpadding: 10px;\n\t}\n</style>\n"],"names":["uni","uniCloud"],"mappings":";;;;;;;AAEC,SAAS,aAAa,KAAK;AAC1B,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;;AACvC,QAAI,GAAC,SAAI,WAAW,aAAf,mBAAyB,SAAQ;AACrCA,oBAAAA,MAAA,MAAA,OAAA,gBAAY,kBAAkB;AAC9B,cAAQ,CAAE,CAAA;AACV;AAAA,IACD;AAEAA,kBAAAA,MAAA,MAAA,OAAA,iBAAY,aAAa;AACzBC,kBAAAA,GAAS,aAAa;AAAA,MACrB,MAAM;AAAA,MACN,MAAM;AAAA,QACL,QAAQ;AAAA,QACR,QAAQ,IAAI,WAAW,SAAS;AAAA,MACjC;AAAA,IACA,CAAA,EAAE,KAAK,CAAC,EAAE,aAAa;AACvBD,oBAAA,MAAA,MAAA,OAAA,iBAAY,YAAY,MAAM;AAC9B,UAAI,OAAO,YAAY,GAAG;AACzB,YAAI,WAAW,YAAY,OAAO;AAClCA,4BAAA,MAAA,OAAA,iBAAY,aAAa,OAAO,KAAK,MAAM;AAC3C,gBAAQ,OAAO,IAAI;AAAA,aACb;AACN,gBAAQ,CAAE,CAAA;AAAA,MACX;AAAA,KACA,EAAE,MAAM,OAAK;AACbA,0DAAc,aAAa,CAAC;AAC5B,aAAO,CAAC;AAAA,IACT,CAAC;AAAA,EACF,CAAC;AACF;AAEA,MAAK,YAAU;AAAA,EACd,YAAY;AAAA,IACX,UAAU;AAAA,IACV,WAAW,CAAC;AAAA,EACZ;AAAA,EACD,MAAM,WAAW;AAChB,QAAI;AACHA,oBAAAA,oCAAY,cAAc;AAE1B,YAAM,WAAW,MAAMA,cAAG,MAAC,MAAM;AAAA,QAChC,UAAU;AAAA,MACX,CAAC;AAEDA,oBAAA,MAAA,MAAA,OAAA,iBAAY,SAAS,QAAQ;AAC7B,UAAI,SAAS,MAAM;AAElBA,sBAAAA,MAAA,MAAA,OAAA,iBAAY,kBAAkB;AAC9B,cAAM,EAAE,WAAW,MAAMC,cAAAA,GAAS,aAAa;AAAA,UAC9C,MAAM;AAAA,UACN,MAAM;AAAA,YACL,QAAQ;AAAA,YACR,MAAM,SAAS;AAAA,UAChB;AAAA,QACD,CAAC;AAEDD,sBAAY,MAAA,MAAA,OAAA,iBAAA,mBAAmB,MAAM;AACrC,YAAI,OAAO,YAAY,GAAG;AAEzB,eAAK,WAAW,WAAW;AAAA,YAC1B,QAAQ,OAAO;AAAA;AAEhBA,8BAAA,MAAA,OAAA,iBAAY,WAAW,KAAK,WAAW,QAAQ;AAI/C,cAAI;AACH,kBAAM,aAAa,IAAI;AAAA,UACxB,SAAS,GAAG;AACXA,0BAAA,MAAA,MAAA,SAAA,iBAAc,WAAW,CAAC;AAAA,UAC3B;AAAA,QACD;AAAA,MACD;AAAA,IACD,SAAS,GAAG;AACXA,oBAAA,MAAA,MAAA,SAAA,iBAAc,SAAS,CAAC;AAAA,IACzB;AAAA,EACA;AAAA,EACD,QAAQ,WAAW;AAClBA,kBAAAA,MAAY,MAAA,OAAA,iBAAA,UAAU;AAAA,EACtB;AAAA,EACD,QAAQ,WAAW;AAClBA,kBAAAA,MAAY,MAAA,OAAA,iBAAA,UAAU;AAAA,EACvB;AACD;;;;;;;;;"}